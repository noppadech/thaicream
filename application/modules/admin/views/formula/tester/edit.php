<div class="row">    <div class="col-sm-12 col-md-12">        <?php        foreach ($materials as $key => $value) {            $options[$value->id] = $value->material_code . " | " . $value->material_trade_name . " | " . $value->material_trade_name_2;        }        echo Modules::run('adminlte/Widget/box_open', '', $style = 'primary', $solid = FALSE);        $attributes = array(            'class' => 'form-horizontal'        );        echo form_open('admin/formula/tester/edit_process/' . $master_id.'/'.$tester_id, $attributes);        ?>         <div class="col-md-6">             <div class="input-group">                <label class="input-group-addon" for="formula_name">ชื่อสูตร</label>                <input id="formula_name" name="formula_name" value="<?php echo $result->formula_name ?>" class="form-control" placeholder="ชื่อสูตร" type="text" required="">            </div>         </div>        <div class="col-md-6">            <div class="form-group">                <label class="col-md-3 control-label" for="formula_remark">หมายเหตุ</label>                <div class="col-md-9">                                         <textarea class="form-control" id="formula_remark" name="formula_remark" placeholder="หมายเหตุ" style="resize: vertical"><?php echo $result->formula_remark ?></textarea>                </div>            </div>        </div>        <fieldset class="col-md-12">            <legend>สูตรการผลิต</legend>             <?php            $result_formula_path = $this->data->get_formula_path_id($result->id);            foreach ($result_formula_path as $key => $value) {                $result_formula_path_details = $this->data->get_formula_path_details_id($value->id);                ?>                 <div class="row path_formula" data-id="<?php echo $value->id;?>">                    <div class="col-md-6">                          <div class="input-group">                            <label class="input-group-addon" for="path_name">PATH NAME</label>                            <input id="path_name" name="path_name[<?php echo $key; ?>]" value="<?php echo $value->path_name ?>" class="form-control" placeholder="placeholder" type="text" required="">                            <?php echo form_hidden('path_name_id['.$key.']',$value->id);?>                        </div>                    </div>                    <div class="col-md-12">                        <table id="table_matrials_<?php echo$key ;?>" class="table table-bordered">                            <thead>                                <tr>                                    <th class="text-center<?php echo (is_null($result_master->formula_selected))?"":" hidden";?>" style="width: 50px;">Action</th>                                    <th>รหัส | ชื่อวัตถุดิบ</th>                                    <th class="text-center"  style="width: 150px;">%</th>                                </tr>                            </thead>                            <tbody>                                <?php                                $summary = 0;                                foreach ($result_formula_path_details as $formula_key => $formula_value) {                                    ?>                                    <tr id="material_details_<?php echo $key . $formula_key; ?>">                                        <td class="text-center<?php echo (is_null($result_master->formula_selected))?"":" hidden";?>">                                            <button type="button"                                                     class="btn btn-danger"                                                     onclick="remove_materials('<?php echo $key . $formula_key; ?>',this);"                                                    data-id="<?php echo $formula_value->id;?>" >                                                ลบ                                            </button>                                        </td>                                        <td>                                            <?php                                            echo form_hidden('path_materials_code_id[' . $key . '][]',$formula_value->id);                                            $selected = $formula_value->path_materials_code;                                            $extra = 'name="path_materials_code[' . $key . '][]" onchange="set_value(this);" class="form-control select2" style="width: 100%;"';                                            echo form_dropdown('', $options, $selected, $extra);                                            ?>                                        </td>                                        <td>                                            <input type="text" name="path_materials_quantity[<?php echo$key; ?>][]"                                                    class="form-control text-right" onkeyup="calculate_formula()"                                                    value="<?php echo $formula_value->path_materials_quantity; ?>" />                                        </td>                                    </tr>                                    <?php                                    $summary += $formula_value->path_materials_quantity;                                }                                ?>                            </tbody>                            <tfoot>                                <tr>                                    <td colspan="4" >                                        <button type="button" class="btn btn-primary pull-left" onclick="add_materials(<?php echo $key;?>)"> + วัตถุดิบ</button>                                     </td><!--                                    <td class="text-right">                                                                                <span id="sumary">                                            <?php // echo $summary; ?>                                        </span>                                    </td>-->                                </tr>                                <tr>                            </tr>                            </tfoot>                        </table>                    </div>                 </div>                <?php            }            ?>            <hr/>             <div class="row">                 <div class="col-md-12 text-right">                    <span id="sumary">                        <?php echo $summary; ?>                    </span>                </div>                <div class="col-md-12">                      <button type="button" class="btn btn-primary pull-left<?php echo (is_null($result_master->formula_selected))?"":" hidden";?>" onclick="add_path();"> + ขั้นตอน</button>                    <button type="button" style="margin-left: 5px;" class="btn btn-danger pull-left<?php echo (is_null($result_master->formula_selected))?"":" hidden";?>" onclick="remove_path();"> - ขั้นตอน</button>                    <button type="button" style="margin-left: 5px;" class="btn btn-warning pull-right" onclick="history.back();">ย้อนกลับ</button>                    <button type="reset" style="margin-left: 5px;" class="btn btn-danger pull-right<?php echo (is_null($result_master->formula_selected))?"":" hidden";?>">ยกเลิก</button>                    <button type="submit" style="margin-left: 5px;" class="btn btn-success pull-right<?php echo (is_null($result_master->formula_selected))?"":" hidden";?>">บันทึกข้อมูล</button>                </div>            </div>        </fieldset>        <?php                echo form_close();        echo Modules::run('adminlte/Widget/box_close');        ?>     </div> </div> <link rel="stylesheet" href="<?php echo base_url('assets/dist/admin/select2/select2.css?v=' . date('ymdhis')); ?>"><script type="text/javascript" src="<?php echo base_url('assets/dist/admin/select2/select2.full.min.js'); ?>"></script><script type="text/javascript" src="<?php echo base_url('assets/dist/admin/mustache-master/mustache.min.js'); ?>"></script><script type="text/javascript">    $(function () {	$(".select2").select2();	calculate_formula();}); function calculate_formula(){        	var qty = $('input[name^=path_materials_quantity]');        	var summary = 0;        	$.each(qty,function(index,value){         		summary+=parseFloat($(value).val())        	});        	if(summary.toFixed(4) === "100.0000"){  			$('button[type^=submit]').removeAttr("disabled");        		}else{//			$('button[type^=submit]').attr("disabled","disabled"); 			$('button[type^=submit]').removeAttr("disabled"); 	}              		$('#sumary').html(summary.toFixed(4));    	}    	function add_path() {        		var path_count = $('.path_formula').length;        		var template = $('#template').html();        		var rendered = Mustache.render(template, {path_count: path_count});        		console.log(path_count);        		$('.path_formula').last().after(rendered);    	}    	function remove_path() {         		var chk = confirm('***กรุณายืนยันการลบข้อมูล***\n\nกรณีลบข้อมูลแล้วจะไม่สามารถเรียกกลับคืนได้');        		if(chk){            			if ($('.path_formula').length > 1) {              				var path_id = $('.path_formula').last().data('id');                				var csrf_test_name = $('input[name^=csrf_test_name]').val();                				$('.path_formula').last().remove();                				$.ajax({                					url:"<?php echo site_url('admin/formula/tester/remove_path');?>",   					type: "POST",                  					data:{path_id:path_id,csrf_test_name:csrf_test_name},           					success: function (data, textStatus, jqXHR) {                						var res = JSON.parse(data);                          						console.log(res);                  						$('input[name^=csrf_test_name]').val(res.hash);      					},                					error: function (jqXHR, textStatus, errorThrown) {    					},                  					complete: function (jqXHR, textStatus ) {   					}             				});        			}       		}   	}   	function add_materials(id) {        		var d = new Date();      		var n = d.getTime();      		var template = $('#template_materials').html();   		var rendered = Mustache.render(template, {auto_id: id, id_remove: n});  		$('#table_matrials_' + id + ' tbody > tr').last().after(rendered);   	}   	function remove_materials(id,obj) {       		var chk = confirm('***กรุณายืนยันการลบข้อมูล***\n\nกรณีลบข้อมูลแล้วจะไม่สามารถเรียกกลับคืนได้');     		if(chk){        			var csrf_test_name = $('input[name^=csrf_test_name]').val();        			var obj_id = $(obj).data('id');          			if(obj_id === "new"){           				console.log("New Object")        			}else{     				$.ajax({          					url: "<?php echo site_url('admin/formula/tester/remove_details');?>/"+obj_id,  					type: "POST",                  					data: {id:obj_id,csrf_test_name:csrf_test_name},  					success: function (data, textStatus, jqXHR) {  						var res = JSON.parse(data);        						$('input[name^=csrf_test_name]').val(res.hash);  					}              				});       			}           			$('#material_details_' + id).remove();    			calculate_formula();    		} 	}</script> <script id="template" type="x-tmpl-mustache"><div class="row path_formula">    <div class="col-md-6">          <div class="input-group">            <label class="input-group-addon" for="path_name_{{path_count}}">PATH NAME</label>            <input id="path_name_{{path_count}}" name="path_name[{{path_count}}]" class="form-control" placeholder="placeholder" type="text" required="">        </div>    </div>    <div class="col-md-12">           <table id="table_matrials_{{path_count}}" class="table table-bordered">            <thead>                <tr>                    <th class="text-center" style="width: 50px;">Action</th>                    <th>รหัส | ชื่อวัตถุดิบ</th>                    <th class="text-center"  style="width: 150px;">%</th>                </tr>            </thead>            <tbody>                <tr>                    <td class="text-center">-</td>                    <td>                         <select name="path_materials_code[{{path_count}}][]" class="form-control select2" style="width: 100%;">                            <?php foreach ($materials as $key => $value) {?>                                <option value="<?php echo $value->id; ?>">                                    <?php                                    echo $value->material_code . " | " . $value->material_trade_name . " | " . $value->material_trade_name_2;                                    ?>                                </option>                            <?php } ?>                        </select>                     </td>                    <td>                        <input type="text" name="path_materials_quantity[{{path_count}}][]" onkeyup="calculate_formula()" class="form-control" />                    </td>                </tr>            </tbody>            <tfoot>                <tr>                    <td colspan="4">                         <button type="button" class="btn btn-primary pull-left" onclick="add_materials({{path_count}})"> + วัตถุดิบ</button>                     </td>                </tr>            </tfoot>        </table>    </div> </div></script><script id="template_materials" type="x-tmpl-mustache">    <tr id="material_details_{{id_remove}}">        <td class="text-center">            <button type="button" class="btn btn-danger" data-id="new" onclick="remove_materials({{id_remove}},this);">ลบ</button>        </td>        <td>            <select name="path_materials_code[{{auto_id}}][]" class="form-control select2" style="width: 100%;">                <?php                foreach ($materials as $key => $value) {                    ?>                    <option value="<?php echo $value->id; ?>"><?php echo $value->material_code . " | " . $value->material_trade_name . " | " . $value->material_trade_name_2; ?></option>                    <?php                }                ?>                          </select>         </td>        <td>            <input type="text" name="path_materials_quantity[{{auto_id}}][]" onkeyup="calculate_formula()" class="form-control" />        </td>    </tr></script> 